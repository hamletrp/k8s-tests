# Argo CD Application to install Rancher via Helm and expose it using nginx ingress

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: rancher
  namespace: argocd
spec:
  project: default

  source:
    repoURL: https://releases.rancher.com/server-charts/latest
    chart: rancher
    targetRevision: 2.8.2   # Update to the latest version as needed
    helm:
      values: |
        hostname: rancher.example.com

        ingress:
          enabled: true
          ingressClassName: nginx
          tls: true
          extraAnnotations:
            kubernetes.io/ingress.class: nginx
            cert-manager.io/cluster-issuer: letsencrypt-prod

        replicas: 3
        bootstrapPassword: "rancheradmin123"

  destination:
    server: https://kubernetes.default.svc
    namespace: cattle-system

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
